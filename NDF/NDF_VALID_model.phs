«PROC RegisterSystemPage»
«IF @exists("_MerchantId") == 0 »
    «VAR NEW _MerchantId = «idMerchant»»
«ENDIF»
«LET _PageName="Validation of Expense;Validation de frais;"»

 «INCLUDE _SystemPageId=«#SQLLIBRARY#»:OSSPageRegister.phs;_PageLibraryId=NDF_LIBRARY_ID;_PageId=NDF_VALID_PAGE_ID»
 «IF _SystemPageId>0»
    «INCLUDE _b_status=«#SQLLIBRARY#»:OSSPageUpdateOpen.phs»
    «*Register Zone 1*»
    «VAR NEW _ZoneName="Validation de frais"»

    «INCLUDE _SystemZoneId=«#SQLLIBRARY#»:OSSPageZoneRegister.phs;_PageLibraryId=NDF_LIBRARY_ID;_PageId=NDF_VALID_PAGE_ID;_PageZoneId=1;_ZoneType=OSS_PAGE_ZONE_TYPE_NORMAL;_ZoneLayoutType=OSS_PAGE_ZONE_LAYOUT_TYPE_FORM_NORMAL;_ZoneLayoutStyle=2;_ZoneRequired=1;_ZoneDirection=1»
    _SystemZoneId :«_SystemZoneId»
    «INCLUDE _SqlStatus=«#SQLLIBRARY#»:OSSPageZoneUpdateOpen.phs;PageZoneId=1;_FieldLibraryId=NDF_LIBRARY_ID;_MerchantId=«_MerchantId»»
    «IF _SystemZoneId>0»
        «*Register system fields for Zone 1*»
        «*Field 101*»
        «LET _FieldName="Date;Date"»
        «INCLUDE _SystemFieldId=«#SQLLIBRARY#»:OSSPageZoneFieldRegister.phs;_PageLibraryId=NDF_LIBRARY_ID;_PageId=NDF_VALID_PAGE_ID;_PageZoneId=1;_FieldLibraryId=NDF_LIBRARY_ID;_FieldId=102;_FieldType=OSS_PAGE_ZONE_FIELD_TYPE_INPUT_TEXT;_FieldRequired=2;_FieldUnique=2;_FieldHAlign=0»
        «*Field 202*»

        «LET _FieldName="Amount;Montant"»
        «INCLUDE _SystemFieldId=«#SQLLIBRARY#»:OSSPageZoneFieldRegister.phs;_PageLibraryId=NDF_LIBRARY_ID;_PageId=NDF_VALID_PAGE_ID;_PageZoneId=1;_FieldLibraryId=NDF_LIBRARY_ID;_FieldId=101;_FieldType=OSS_PAGE_ZONE_FIELD_TYPE_INPUT_TEXT;_FieldRequired=2;_FieldUnique=2;_FieldHAlign=0»


    «ENDIF»
    «INCLUDE _SqlStatus=«#SQLLIBRARY#»:OSSPageZoneUpdateClose.phs;PageZoneId=1;_FieldLibraryId=NDF_LIBRARY_ID;_MerchantId=«_MerchantId»»

    «*Register Zone 2*»
    «VAR NEW _ZoneName="Buttons"»

    «INCLUDE _SystemZoneId=«#SQLLIBRARY#»:OSSPageZoneRegister.phs;_PageLibraryId=NDF_LIBRARY_ID;_PageId=NDF_VALID_PAGE_ID;_PageZoneId=2;_ZoneType=OSS_PAGE_ZONE_TYPE_NORMAL;_ZoneLayoutType=OSS_PAGE_ZONE_LAYOUT_TYPE_MENU_NORMAL;_ZoneLayoutStyle=2;_ZoneRequired=1;_ZoneDirection=1»
    _SystemZoneId :«_SystemZoneId»
    «INCLUDE _SqlStatus=«#SQLLIBRARY#»:OSSPageZoneUpdateOpen.phs;PageZoneId=2;_FieldLibraryId=NDF_LIBRARY_ID;_MerchantId=«_MerchantId»»
    «IF _SystemZoneId>0»
        «*Register system fields for Zone 2*»
        «*Field 201*»
        «LET _FieldName="Save;Sauvegarder"»
        «INCLUDE _SystemFieldId=«#SQLLIBRARY#»:OSSPageZoneFieldRegister.phs;_PageLibraryId=NDF_LIBRARY_ID;_PageId=NDF_VALID_PAGE_ID;_PageZoneId=2;_FieldLibraryId=NDF_LIBRARY_ID;_FieldId=202;_FieldType=OSS_PAGE_ZONE_FIELD_TYPE_BUTTON;_FieldRequired=2;_FieldUnique=2;_FieldHAlign=0»
        «*Field 202*»

        «LET _FieldName="Back;Retour"»
        «INCLUDE _SystemFieldId=«#SQLLIBRARY#»:OSSPageZoneFieldRegister.phs;_PageLibraryId=NDF_LIBRARY_ID;_PageId=NDF_VALID_PAGE_ID;_PageZoneId=2;_FieldLibraryId=NDF_LIBRARY_ID;_FieldId=201;_FieldType=OSS_PAGE_ZONE_FIELD_TYPE_BUTTON;_FieldRequired=2;_FieldUnique=2;_FieldHAlign=0»



    «ENDIF»
    «INCLUDE _SqlStatus=«#SQLLIBRARY#»:OSSPageZoneUpdateClose.phs;PageZoneId=2;_FieldLibraryId=NDF_LIBRARY_ID;_MerchantId=«_MerchantId»»


    «*Register other zones by calling OSSPageZoneRegister again*»
    «INCLUDE _SqlStatus=«#SQLLIBRARY#»:OSSPageUpdateClose.phs»
«ENDIF»
«INCLUDE _b_status=«#SQLLIBRARY#»:OSSThemePageZoneUpdateClose.phs»
«RETURN 1»
«/PROC»




«PROC RegisterDefaultThemes»

    «VAR NEW _b_status = 1»
    «VAR NEW _FieldLibraryId = NDF_LIBRARY_ID »
    «IF @toi(_PageLibraryId)==NDF_LIBRARY_ID »
        «IF @toi(_PageId)== NDF_VALID_PAGE_ID »

            «* zone 1*»
            «IF _b_status ==1 »
                «INCLUDE _b_status = NDF:NDF_VALID_model.phs#RegisterThemePagesZone_1 »
            «ENDIF»
            «* zone 2*»
            «IF _b_status ==1 »
                «INCLUDE _b_status = NDF:NDF_VALID_model.phs#RegisterThemePagesZone_2 »
            «ENDIF»

        «ENDIF»
    «ENDIF»
    «RETURN _b_status»
«/PROC»

«PROC RegisterThemePagesZone_1»

    «VAR NEW _FieldLibraryId = NDF_LIBRARY_ID »
    «VAR NEW _FieldVisible = 1»
    «VAR NEW _PageZoneId = 1»
    «VAR NEW _ZoneName=""»
    «VAR NEW _b_status = 1»
    «VAR NEW _SystemZoneId = 0 »
    «VAR NEW [object]_objZoneInfo»
    «VAR NEW _ZoneLabel = "" »
    «LET _ZoneLabel="Edit validation;Edition de validation"»
    «INCLUDE _b_status=«#SQLLIBRARY#»:OSSThemePageZoneRegister.phs;_ZoneColumns=3;_ZoneVisible=1;_pZoneObject=&_objZoneInfo;_ZoneStyleTitle=OSS_PAGE_ZONE_STYLE_TITLE_NORMAL;_ZoneStyleHeader=OSS_PAGE_ZONE_STYLE_HEADER_NORMAL»
    «IF _b_status==0»
        «INCLUDE «#SQLLIBRARY#»:ProcDebug.phs#ErrorLog;_err_message="cannot registered Zone 1 ";_err_file="NDF_VALID_model.phs#RegisterThemePagesZone_1";_err_number="0x0001";_bForce=1»
    «ELSE»
        «INCLUDE _b_status=«#SQLLIBRARY#»:OSSThemePageZoneUpdateOpen.phs»
        «IF _b_status == 0»
            «INCLUDE «#SQLLIBRARY#»:ProcDebug.phs#ErrorLog;_err_message="Zone 1 OSSThemePageZoneUpdateOpen failed";_err_file="NDF_VALID_model.phs#RegisterThemePagesZone_1";_err_number="0x0002";_bForce=1»
        «ELSE»
            «VAR NEW _FieldColumn=1»
            «INCLUDE «#SQLLIBRARY#»:OSSThemePageZoneFieldRegister.phs;_FieldId=101;_FieldOrder=1»
            «INCLUDE «#SQLLIBRARY#»:OSSThemePageZoneFieldRegister.phs;_FieldId=102;_FieldOrder=2»


            «INCLUDE _b_status=«#SQLLIBRARY#»:OSSThemePageZoneUpdateClose.phs»
            «IF _b_status == 0»
                «INCLUDE «#SQLLIBRARY#»:ProcDebug.phs#ErrorLog;_err_message="Zone 1 OSSThemePageZoneUpdateClose failed";_err_file="NDF_VALID_model.phs.phs#RegisterThemePagesZone_1";_err_number="0x0003";_bForce=1»
            «ENDIF»
        «ENDIF»
    «ENDIF»
    «RETURN _b_status»
«/PROC»

«PROC RegisterThemePagesZone_2»

    «VAR NEW _FieldLibraryId = NDF_LIBRARY_ID »
    «VAR NEW _FieldVisible = 1»
    «VAR NEW _PageZoneId = 2»
    «VAR NEW _ZoneName=""»
    «VAR NEW _b_status = 1»
    «VAR NEW _SystemZoneId = 0 »
    «VAR NEW [object]_objZoneInfo»
    «VAR NEW _ZoneLabel = "" »
    «LET _ZoneLabel="buttons; boutons"»
    «INCLUDE _b_status=«#SQLLIBRARY#»:OSSThemePageZoneRegister.phs;_ZoneColumns=3;_ZoneVisible=1;_pZoneObject=&_objZoneInfo;_ZoneStyleTitle=OSS_PAGE_ZONE_STYLE_TITLE_NONE;_ZoneStyleHeader=OSS_PAGE_ZONE_STYLE_HEADER_NORMAL»
    «IF _b_status==0»
        «INCLUDE «#SQLLIBRARY#»:ProcDebug.phs#ErrorLog;_err_message="cannot registered Zone 2 ";_err_file="NDF_VALID_model.phs#RegisterThemePagesZone_2";_err_number="0x0001";_bForce=1»
    «ELSE»
        «INCLUDE _b_status=«#SQLLIBRARY#»:OSSThemePageZoneUpdateOpen.phs»
        «IF _b_status == 0»
            «INCLUDE «#SQLLIBRARY#»:ProcDebug.phs#ErrorLog;_err_message="Zone 2 OSSThemePageZoneUpdateOpen failed";_err_file="NDF_VALID_model.phs#RegisterThemePagesZone_2";_err_number="0x0002";_bForce=1»
        «ELSE»
            «VAR NEW _FieldColumn=1»
            «INCLUDE «#SQLLIBRARY#»:OSSThemePageZoneFieldRegister.phs;_FieldId=201;_FieldOrder=1»
            «INCLUDE «#SQLLIBRARY#»:OSSThemePageZoneFieldRegister.phs;_FieldId=202;_FieldOrder=2»

            «INCLUDE _b_status=«#SQLLIBRARY#»:OSSThemePageZoneUpdateClose.phs»
            «IF _b_status == 0»
                «INCLUDE «#SQLLIBRARY#»:ProcDebug.phs#ErrorLog;_err_message="Zone 2 OSSThemePageZoneUpdateClose failed";_err_file="NDF_VALID_model.phs.phs#RegisterThemePagesZone_2";_err_number="0x0003";_bForce=1»
            «ENDIF»
        «ENDIF»
    «ENDIF»
    «RETURN _b_status»
«/PROC»


«PROC CallbackZone»

«VAR NEW _Visible=_PageZoneVisible»



    «IF _PageLibraryId==NDF_LIBRARY_ID && _PageZoneId==1»
        «INCLUDE _Visible = NDF:NDF_VALID_model.phs#CallbackZone_1»
    «ELSEIF _PageLibraryId==NDF_LIBRARY_ID && _PageZoneId==2»
        «INCLUDE _Visible = NDF:NDF_VALID_model.phs#CallbackZone_2»
    «ENDIF»
    «RETURN 1»

«/PROC»

«PROC CallbackZone_1»
    «VAR NEW _Visible=_PageZoneVisible»

    «IF @exists("_PageZoneComponent")==0»
        «INCLUDE «#SQLLIBRARY#»:ProcPageTheme.phs#ViewPageZone»
    «ENDIF»

    «RETURN _Visible»
«/PROC»
«PROC CallbackZone_2»
    «VAR NEW _Visible=_PageZoneVisible»

    «IF @exists("_PageZoneComponent")==0»
        «INCLUDE «#SQLLIBRARY#»:ProcPageTheme.phs#ViewPageZone»
    «ENDIF»

    «RETURN _Visible»
«/PROC»

«PROC CallbackField»

    «VAR NEW _Visible=-1»

    «IF _ZoneFieldLibraryId==NDF_LIBRARY_ID  &&  _PageZoneId==1 &&_ZoneFieldVisible==1»
        «INCLUDE _Visible = NDF:NDF_VALID_model.phs#CallbackField_Zone_1»

    «ELSEIF _ZoneFieldLibraryId==NDF_LIBRARY_ID && _PageZoneId==2 && _ZoneFieldVisible==1»
        «INCLUDE _Visible = NDF:NDF_VALID_model.phs#CallbackField_Zone_2»

    «ENDIF»
    «RETURN _Visible»
«/PROC»


«PROC CallbackField_Zone_1»
    «VAR NEW _Visible=-1»
    «IF @exists("_MerchantId") == 0 »
        «VAR NEW _MerchantId = «idMerchant»»
    «ENDIF»
    «*Field 101*»
    «IF _ZoneFieldId == 101»

        «LET _Visible=_ZoneFieldVisible»
                  «IF _ZoneFieldComponent==0»
                  <FORM id="MyForm" name="MyForm" method="post" action="/Scripts/sql.exe">
                            <input type="hidden" name="SqlDB" value="«SqlDB»">
                            <input type="hidden" name="Sql" value="">
                            <input type="hidden" name="xid" value="«xid»">
                            <input type="hidden" name="iMod" value="«iMod»">
                            <input type="hidden" name="_id" value="«_id»">
                            <input type="hidden" name="_idU" value="«_idU»">
                            <input type="hidden" name="iMan" value="«iMan»">
                  «ELSEIF @toi(_ZoneFieldComponent)==1»
                      <div><label for="_Date">«WRITE LANGUAGE %html;Pay Date;Date de Paiement»</label>
                  «ELSEIF @toi(_ZoneFieldComponent)==2»
                  <div style="margin-bottom: 10px;" class="group-input date">
                      «IF @toi(iMod)==0»
                      <input type="text" name="_Date" id="_Date" value="«=@strdate(@today();6)»"class="form-control"  placeholder="dd/mm/yyyy"/>
                      <button class="input-group-addon"><span class="fa fa-calendar"></span></button>
                      «ELSEIF @toi(iMod)==1»
                      «SQLEXEC DOUBLE iTime=SELECT iCTime From NDF_ACCOUNT where idNDF = «_id»»
                      <input type="text" name="_Date" id="_Date" value="«=@timestr(iTime;6)»"class="form-control"  placeholder="dd/mm/yyyy"/>
                      <button class="input-group-addon"><span class="fa fa-calendar"></span></button>
                      «ENDIF»
                  </div>
                  «ENDIF»
    «*Field 102*»
    «ELSEIF @toi(_ZoneFieldId) ==102 »

        «LET _Visible=_ZoneFieldVisible»
        «IF _ZoneFieldComponent==0»
        «ELSEIF @toi(_ZoneFieldComponent)==1»
            <div><label for="_azMontant">«WRITE LANGUAGE %html;Amount;Montant»</label>
        «ELSEIF @toi(_ZoneFieldComponent)==2»
          «IF @toi(iMod)==0»
            «SQLEXEC DOUBLE dMnt=SELECT dMontant From NDF_FACTURES where idNDF = «_id»»
          «ELSEIF @toi(iMod)==1»
            «SQLEXEC DOUBLE dMnt=SELECT dMontant From NDF_ACCOUNT where idNDF = «_id»»
          «ENDIF»
          <input type="number" name="_azMontant" id="_azMontant" value="«dMnt»" min="0.00" max="99999.99"></div>
        «ENDIF»
    «ENDIF»
    «RETURN _Visible»
«/PROC»


«PROC CallbackField_Zone_2»
    «VAR NEW _Visible=-1»
    «*Field 201*»
    «IF _ZoneFieldId == 201»
        «LET _Visible=_ZoneFieldVisible»
        «IF _ZoneFieldComponent==OSS_PAGE_ZONE_FIELD_COMPONENT_VALUE»

              <button class="btn-default" type="button" onclick="onBack()">«WRITE LANGUAGE Back;Retour» </button>

          <script language="JavaScript">
            function onBack() {
              document.MyForm.Sql.value = "NDF:NDF_VIEWACCOUNT_view.phs" ;
              document.MyForm.submit();
            }
          </script>
        «ENDIF»
    «*Field 202*»
    «ELSEIF @toi(_ZoneFieldId) ==202 »
        «LET _Visible=_ZoneFieldVisible»
        «IF _ZoneFieldComponent==OSS_PAGE_ZONE_FIELD_COMPONENT_VALUE»

              <button class="btn-default" type="button" onclick="onSave()">«WRITE LANGUAGE Validate ;Valider»</button>

          <script language="JavaScript">
            function onSave() {
              document.MyForm.Sql.value = "NDF:NDF_VALID_query.phs" ;
              document.MyForm.submit();
            }
          </script>
        «ENDIF»
   «ENDIF»
    «RETURN _Visible»
«/PROC»
